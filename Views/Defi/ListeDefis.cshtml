@model SAINTJWebApp.ViewModels.ListeDefisViewModel

@{
    ViewData["Title"] = "Liste des défis";
    var ordreDifficulte = new List<string> { "facile", "moyen", "difficile", "extreme" };
}

<h2>Nombre de défis à ajouter :</h2>
<p>Défis à ajouter restants : <strong>@Model.DefiAjoutRestant</strong></p>

<br/>

<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalAjoutDefi">
    Ajouter un défi
</button>

<br/>

<h2>Défis par difficulté</h2>

<div class="accordion" id="accordionDefis">
    @foreach (var difficulte in ordreDifficulte)
    {
        if (Model.DefisParDifficulte.ContainsKey(difficulte))
        {
            var defis = Model.DefisParDifficulte[difficulte];
            var idAccordeon = $"collapse-{difficulte}";

            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-@difficulte">
                    <button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#@idAccordeon"
                            aria-expanded="false"
                            aria-controls="@idAccordeon">
                        @difficulte.ToUpperInvariant()
                    </button>
                </h2>
                <div id="@idAccordeon"
                     class="accordion-collapse collapse"
                     aria-labelledby="heading-@difficulte"
                     data-bs-parent="#accordionDefis">
                    <div class="accordion-body">
                        @foreach (var defi in defis)
                        {
                            var estCoche = defi.EstAccompli;
                            <form asp-action="ToggleDefi" asp-controller="Defi" method="post">
                                <input type="hidden" name="defiId" value="@defi.Id" />
                                <input type="checkbox" onchange="this.form.submit()" @(estCoche ? "checked" : "") />
                                <span>@defi.Titre - @defi.Points pts (@defi.Difficulte)</span>
                            </form>
                        }
                    </div>
                </div>
            </div>
        }
    }
</div>

<br/>

<a asp-action="Index" asp-controller="Menu" class="text-center">Retour</a>

@await Html.PartialAsync("_AjoutDefis", new SAINTJWebApp.Models.Defi())
