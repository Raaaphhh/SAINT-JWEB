@model SAINTJWebApp.ViewModels.AdminViewModel

@{
    ViewData["Title"] = "Admin";
    var ordreDifficulte = new List<string> { "facile", "moyen", "difficile", "extreme" };
}

<div class="text-center">
    <h2>Admin</h2>

    <button class="btn btn-dark mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#tableauAdmin" aria-expanded="false" aria-controls="tableauAdmin">
        Gestion des Scores
    </button>

    <br/>

    <button class="btn btn-dark mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#tableauDefis" aria-expanded="false" aria-controls="tableauDefis">
        Gestion des Défis
    </button>
</div>


@* tableau gestion des scores *@
<div class="collapse" id="tableauAdmin">
    <table class="table table-striped table-bordered table-hover mt-4">
        <thead class="thead-dark">
        <tr>
            <th>Pseudo</th>
            <th>Score</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        @foreach(var user in Model.Users)
        {
            <tr>
                <td>@user.userName</td>
                <td class="fw-bold">@user.score</td>
                <td>
                    <button type="button" class="btn btn-sm btn-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#modalModifierScore"
                            data-userid="@user.idUSer"
                            data-username="@user.userName"
                            data-score="@user.score">
                        Modifier le score
                    </button>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>


@* tableau gestion des defis *@
<div class="collapse" id="tableauDefis">
    <div class="accordion" id="accordionDefis">
        @foreach (var difficulte in ordreDifficulte)
        {
            if (Model.DefisParDifficulte.ContainsKey(difficulte))
            {
                var defis = Model.DefisParDifficulte[difficulte];
                var idAccordeon = $"collapse-{difficulte}";

                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-@difficulte">
                        <button class="accordion-button collapsed" type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#@idAccordeon"
                                aria-expanded="false"
                                aria-controls="@idAccordeon">
                            @difficulte.ToUpperInvariant()
                        </button>
                    </h2>
                    <div id="@idAccordeon"
                         class="accordion-collapse collapse"
                         aria-labelledby="heading-@difficulte"
                         data-bs-parent="#accordionDefis">
                        <div class="accordion-body">
                            @foreach (var defi in defis)
                            {
                                <input type="hidden" name="defiId" value="@defi.id" />
                                <span>@defi.titre - @defi.points pts (@defi.difficulte)</span>
                                <button type="submit" class="btn btn-primary"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalModifierDefis"
                                        data-defiId="@defi.id"
                                        data-defititre="@defi.titre"
                                        data-defidifficulte="@defi.difficulte">
                                    Modifier
                                </button>
                                <br/>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

@await Html.PartialAsync("_ModifierDefis", new SAINTJWebApp.Models.Defi())
@await Html.PartialAsync("_ModifierScore", new SAINTJWebApp.Models.User())


<!-- pour recuperer les valeurs dans la modal -->
<script>
    const modal = document.getElementById('modalModifierScore');
    modal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const username = button.getAttribute('data-username');
        const score = button.getAttribute('data-score');
        const userId = button.getAttribute('data-userid');

        modal.querySelector('#modalModifierScoreLabel').textContent = "Modifier le score de : " + username;
        modal.querySelector('#inputUserScore').value = score;
        modal.querySelector('#inputUserId').value = userId;
    });

    const modal2 = document.getElementById('modalModifierDefis');
    modal2.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const idDefis = button.getAttribute('data-defiId');
        const titre = button.getAttribute('data-defititre');
        const difficulte = button.getAttribute('data-defidifficulte');

        modal2.querySelector('#modalModifierDefisLabel').textContent = "Modifier le défi : " + titre;
        modal2.querySelector('#inputDefisTitre').value = titre;
        modal2.querySelector('#modalDefisDifficulte').value = difficulte;
        modal2.querySelector('#inputDefisId').value = idDefis;
    });
</script>

